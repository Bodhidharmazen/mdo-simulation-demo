<!DOCTYPE html>
<html>
<head>
  <title>MDO Consciousness Simulation</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    .grid { display: grid; gap: 1px; }
    .cell { width: 15px; height: 15px; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;
    const { createRoot } = ReactDOM;
    
    // Simple icon components
    const Icon = ({ children, size = 20, className = '', ...props }) => {
      return React.createElement('span', {
        className: `inline-block ${className}`,
        style: { 
          width: size, 
          height: size,
          display: 'inline-flex',
          alignItems: 'center',
          justifyContent: 'center'
        },
        ...props
      }, children);
    };

    const Play = (props) => React.createElement(Icon, props, '▶');
    const Pause = (props) => React.createElement(Icon, props, '⏸');
    const RotateCcw = (props) => React.createElement(Icon, props, '↻');
    const Zap = (props) => React.createElement(Icon, props, '⚡');
    const Brain = (props) => React.createElement(Icon, props, '🧠');
    const Activity = (props) => React.createElement(Icon, props, '⟳');

    const MDOConsciousnessSimulation = () => {
      const WORLD_SIZE = 40;
      const SENSORY_RANGE = 2;
      const MAX_ENERGY = 1000;
      
      // Generate substrate - just perturbations, no objects
      const generateSubstrate = () => {
        const substrate = [];
        for (let y = 0; y < WORLD_SIZE; y++) {
          const row = [];
          for (let x = 0; x < WORLD_SIZE; x++) {
            const cell = {
              hiddenProperties: {
                energyPotential: 0,
                resistance: 0,
                growthCycle: 0,
                lastInteraction: -1000,
                originalEnergy: 0,
                gradientIntensity: 0
              }
            };
            
            // Create mathematical perturbations
            const perturbation1 = Math.sin(x * 0.3) * Math.cos(y * 0.3);
            const perturbation2 = Math.sin((x + 10) * 0.2) * Math.cos((y + 10) * 0.2);
            const perturbation3 = Math.sin((x - 5) * 0.4) * Math.cos((y + 15) * 0.4);
            
            const combinedPerturbation = (perturbation1 + perturbation2 * 0.5 + perturbation3 * 0.3 + 1) / 2;
            const gradientIntensity = combinedPerturbation * 100;
            cell.hiddenProperties.gradientIntensity = gradientIntensity;
            
            // Clear a safe starting area around position (20,20)
            const distFromStart = Math.abs(x - 20) + Math.abs(y - 20);
            if (distFromStart < 3) {
              if (Math.random() < 0.2) {
                cell.hiddenProperties.gradientIntensity = 45 + Math.random() * 10;
                cell.hiddenProperties.energyPotential = 30 + Math.floor(Math.random() * 30);
                cell.hiddenProperties.originalEnergy = cell.hiddenProperties.energyPotential;
                cell.hiddenProperties.growthCycle = 800 + Math.floor(Math.random() * 400);
              } else {
                cell.hiddenProperties.gradientIntensity = 10 + Math.random() * 10;
                cell.hiddenProperties.energyPotential = 5 + Math.floor(Math.random() * 5);
                cell.hiddenProperties.originalEnergy = cell.hiddenProperties.energyPotential;
              }
            } else {
              if (gradientIntensity >= 0 && gradientIntensity < 20) {
                cell.hiddenProperties.energyPotential = 5 + Math.floor(Math.random() * 10);
                cell.hiddenProperties.originalEnergy = cell.hiddenProperties.energyPotential;
                cell.hiddenProperties.growthCycle = 100 + Math.floor(Math.random() * 100);
              } else if (gradientIntensity >= 20 && gradientIntensity < 40) {
                cell.hiddenProperties.energyPotential = 15 + Math.floor(Math.random() * 15);
                cell.hiddenProperties.originalEnergy = cell.hiddenProperties.energyPotential;
                cell.hiddenProperties.growthCycle = 300 + Math.floor(Math.random() * 200);
              } else if (gradientIntensity >= 40 && gradientIntensity < 60) {
                if (Math.random() < 0.15) {
                  cell.hiddenProperties.energyPotential = 40 + Math.floor(Math.random() * 60);
                  cell.hiddenProperties.originalEnergy = cell.hiddenProperties.energyPotential;
                  cell.hiddenProperties.growthCycle = 800 + Math.floor(Math.random() * 400);
                }
              } else if (gradientIntensity >= 60 && gradientIntensity < 80) {
                cell.hiddenProperties.resistance = 0.9 + Math.random() * 0.1;
                cell.hiddenProperties.energyPotential = 0;
              } else {
                cell.hiddenProperties.resistance = 1.0;
                cell.hiddenProperties.energyPotential = 0;
              }
            }
            
            row.push(cell);
          }
          substrate.push(row);
        }
        return substrate;
      };
      
      // Initial state
      const [state, setState] = useState(() => {
        const startX = 20;
        const startY = 20;
        const initialAgent = {
          x: startX,
          y: startY,
          energy: 500,
          experienceStream: [],
          constructions: {},
          phenomenalWorld: new Map(),
          alive: true,
          currentBehavior: null,
          homeostasis: {
            energyBaseline: 300,
            deviations: []
          }
        };
        
        initialAgent.phenomenalWorld.set(`${startX},${startY}`, {
          constructedObject: 'Field',
          construction: 'moveable-space',
          reliability: 100,
          lastSeen: 0,
          consumed: false
        });
        
        return {
          substrate: generateSubstrate(),
          agent: initialAgent,
          timeStep: 0,
          consciousness: 0,
          viewMode: 'phenomenal',
          speed: 10,
          paused: true
        };
      });

      // Sensory system
      const getSensorium = useCallback((agent, substrate) => {
        const sensorium = {
          perturbations: [],
          totalIntensity: 0,
          substrate: substrate
        };
        
        for (let dy = -SENSORY_RANGE; dy <= SENSORY_RANGE; dy++) {
          for (let dx = -SENSORY_RANGE; dx <= SENSORY_RANGE; dx++) {
            const distance = Math.abs(dx) + Math.abs(dy);
            if (distance <= SENSORY_RANGE) {
              const worldX = agent.x + dx;
              const worldY = agent.y + dy;
              
              if (worldX >= 0 && worldX < WORLD_SIZE && worldY >= 0 && worldY < WORLD_SIZE) {
                const cell = substrate[worldY][worldX];
                const locationKey = `loc_${worldX}_${worldY}`;
                
                const intensity = cell.hiddenProperties.energyPotential > 0 ? 
                  cell.hiddenProperties.energyPotential / 100 : 
                  -cell.hiddenProperties.resistance;
                
                sensorium.perturbations.push({
                  key: locationKey,
                  intensity,
                  distance,
                  relativePosition: { dx, dy },
                  worldX,
                  worldY
                });
                
                sensorium.totalIntensity += Math.abs(intensity);
              }
            }
          }
        }
        
        return sensorium;
      }, []);

      // Simulation logic
      const constructFromExperience = useCallback((agent, energyChange, sensoriumBefore, sensoriumAfter, behavior, interactionPos, timeStep) => {
        // Implementation of constructFromExperience
        // ... (previous implementation)
      }, []);

      // Behavior selection
      const selectBehavior = useCallback((agent, sensoriumData, substrate) => {
        // Implementation of selectBehavior
        // ... (previous implementation)
      }, []);

      // Simulation step
      const step = useCallback(() => {
        // Implementation of step
        // ... (previous implementation)
      }, [getSensorium, selectBehavior, constructFromExperience]);

      // Run simulation loop
      useEffect(() => {
        let intervalId;
        if (!state.paused && state.agent.alive) {
          intervalId = setInterval(() => {
            step();
          }, 1000 / state.speed);
        }
        return () => clearInterval(intervalId);
      }, [state.paused, state.agent.alive, state.speed, step]);

      // Reset simulation
      const reset = () => {
        const startX = 20;
        const startY = 20;
        const initialAgent = {
          x: startX,
          y: startY,
          energy: 500,
          experienceStream: [],
          constructions: {},
          phenomenalWorld: new Map(),
          alive: true,
          currentBehavior: null,
          homeostasis: {
            energyBaseline: 300,
            deviations: []
          }
        };
        
        initialAgent.phenomenalWorld.set(`${startX},${startY}`, {
          constructedObject: 'Field',
          construction: 'moveable-space',
          reliability: 100,
          lastSeen: 0,
          consumed: false
        });
        
        setState({
          substrate: generateSubstrate(),
          agent: initialAgent,
          timeStep: 0,
          consciousness: 0,
          viewMode: 'phenomenal',
          speed: 10,
          paused: true
        });
      };

      // Toggle pause
      const togglePause = () => {
        setState(prev => ({ ...prev, paused: !prev.paused }));
      };

      // Change speed
      const changeSpeed = (e) => {
        setState(prev => ({ ...prev, speed: parseInt(e.target.value) }));
      };

      // Toggle view mode
      const toggleViewMode = () => {
        setState(prev => ({
          ...prev,
          viewMode: prev.viewMode === 'phenomenal' ? 'substrate' : 'phenomenal'
        }));
      };

      // Agent sprite component
      const AgentSprite = ({ size, energy }) => {
        const healthPercent = Math.max(0, Math.min(100, (energy / 500) * 100));
        const spriteColor = energy > 100 ? '#22c55e' : energy > 50 ? '#eab308' : '#ef4444';
        
        return React.createElement(
          'div',
          { className: 'absolute inset-0 flex items-center justify-center' },
          React.createElement('div', {
            className: 'rounded-full transition-all duration-300',
            style: {
              width: `${size * 0.6}px`,
              height: `${size * 0.6}px`,
              backgroundColor: spriteColor,
              boxShadow: `0 0 ${healthPercent / 10}px ${spriteColor}`,
              opacity: energy > 0 ? 1 : 0.3
            }
          })
        );
      };

      // Render a single cell
      const renderCell = (cell, x, y, agent, viewMode) => {
        const cellSize = 15;
        const isAgent = agent.x === x && agent.y === y;
        
        if (viewMode === 'phenomenal') {
          const phenomenal = agent.phenomenalWorld.get(`${x},${y}`);
          let backgroundColor = '#ffffff';
          let opacity = 1;
          let content = null;
          
          if (!agent.alive) {
            backgroundColor = '#000000';
            opacity = 0.8;
          } else if (phenomenal && (phenomenal.constructedObject || phenomenal.object)) {
            const objType = phenomenal.constructedObject || phenomenal.object;
            
            if (objType === 'Field') {
              backgroundColor = `hsl(120, 40%, 70%)`;
              opacity = 0.8;
            } else if (objType === 'Bush') {
              backgroundColor = `hsl(120, 60%, 35%)`;
              content = React.createElement(
                'div',
                { className: 'absolute inset-0 flex items-center justify-center' },
                React.createElement('div', { className: 'text-xs' }, '🌿')
              );
            } else if (objType === 'Berry') {
              if (phenomenal.consumed) {
                backgroundColor = `hsl(340, 30%, 80%)`;
                content = React.createElement(
                  'div',
                  { className: 'absolute inset-0 flex items-center justify-center' },
                  React.createElement('div', { className: 'text-xs opacity-50' }, '○')
                );
              } else {
                backgroundColor = `hsl(340, 70%, 50%)`;
                content = React.createElement(
                  'div',
                  { className: 'absolute inset-0 flex items-center justify-center' },
                  React.createElement('div', { className: 'text-xs' }, '🍓')
                );
              }
              opacity = 1;
            } else if (objType === 'Grass') {
              backgroundColor = `hsl(90, 50%, 50%)`;
              if (phenomenal.consumed) {
                backgroundColor = `hsl(90, 30%, 70%)`;
                opacity = 0.7;
              }
              content = React.createElement(
                'div',
                { className: 'absolute inset-0 flex items-center justify-center' },
                React.createElement('div', { className: 'text-xs' }, '🌱')
              );
            } else if (objType === 'Tree') {
              backgroundColor = `hsl(100, 30%, 25%)`;
              content = React.createElement(
                'div',
                { className: 'absolute inset-0 flex items-center justify-center' },
                React.createElement('div', { className: 'text-xs' }, '🌳')
              );
            } else if (objType === 'Stone') {
              backgroundColor = `hsl(0, 0%, 50%)`;
              content = React.createElement(
                'div',
                { className: 'absolute inset-0 flex items-center justify-center' },
                React.createElement('div', { className: 'text-xs' }, '⬤')
              );
            }
          }
          
          return React.createElement(
            'div',
            {
              key: `${x}-${y}`,
              className: 'relative border border-gray-200',
              style: {
                width: `${cellSize}px`,
                height: `${cellSize}px`,
                backgroundColor,
                opacity
              }
            },
            content,
            isAgent && agent.alive && React.createElement(AgentSprite, { size: cellSize, energy: agent.energy })
          );
        } else {
          // Substrate view
          const energy = cell.hiddenProperties.energyPotential;
          const resistance = cell.hiddenProperties.resistance;
          
          let backgroundColor = '#e5e7eb';
          
          if (resistance === 1.0) {
            backgroundColor = `hsl(0, 0%, 20%)`;
          } else if (resistance > 0.8) {
            backgroundColor = `hsl(100, 20%, 30%)`;
          } else if (energy > 40) {
            backgroundColor = `hsl(340, 70%, 50%)`;
          } else if (energy > 15) {
            backgroundColor = `hsl(120, 60%, 40%)`;
          } else if (energy > 5) {
            backgroundColor = `hsl(90, 50%, 60%)`;
          } else {
            backgroundColor = '#f5f5f5';
          }
          
          return React.createElement(
            'div',
            {
              key: `${x}-${y}`,
              className: 'relative border border-gray-100',
              style: {
                width: `${cellSize}px`,
                height: `${cellSize}px`,
                backgroundColor
              }
            },
            isAgent && React.createElement(AgentSprite, { size: cellSize, energy: agent.energy })
          );
        }
      };

      // Main UI
      return React.createElement(
        'div',
        { className: 'min-h-screen bg-gray-50 p-8' },
        React.createElement(
          'div',
          { className: 'max-w-7xl mx-auto' },
          // Header
          React.createElement(
            'div',
            { className: 'bg-white rounded-lg shadow-lg p-6 mb-6' },
            React.createElement(
              'h1',
              { className: 'text-3xl font-bold text-gray-800 mb-2' },
              'MDO Consciousness: Pure Emergence'
            ),
            React.createElement(
              'p',
              { className: 'text-gray-600' },
              'The agent IS its world-construction'
            )
          ),
          
          // Main content
          React.createElement(
            'div',
            { className: 'grid grid-cols-1 lg:grid-cols-3 gap-6' },
            // Left panel - Simulation
            React.createElement(
              'div',
              { className: 'lg:col-span-2 bg-white rounded-lg shadow-lg p-6' },
              // Controls
              React.createElement(
                'div',
                { className: 'flex justify-between items-center mb-4' },
                React.createElement(
                  'h2',
                  { className: 'text-xl font-semibold text-gray-800' },
                  state.viewMode === 'phenomenal' ? 'The Agent\'s Reality' : 'Substrate Perturbations'
                ),
                React.createElement(
                  'div',
                  { className: 'flex gap-2' },
                  React.createElement(
                    'button',
                    {
                      onClick: togglePause,
                      className: 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors flex items-center gap-2'
                    },
                    state.paused ? React.createElement(Play, { size: 20 }) : React.createElement(Pause, { size: 20 }),
                    state.paused ? 'Play' : 'Pause'
                  ),
                  React.createElement(
                    'button',
                    {
                      onClick: reset,
                      className: 'px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors flex items-center gap-2'
                    },
                    React.createElement(RotateCcw, { size: 20 }),
                    'Reset'
                  )
                )
              ),
              
              // Speed controls
              React.createElement(
                'div',
                { className: 'mb-4 flex items-center gap-4' },
                React.createElement(
                  'label',
                  { className: 'flex items-center gap-2' },
                  React.createElement(
                    'span',
                    { className: 'text-sm font-medium text-gray-700' },
                    'Speed:'
                  ),
                  React.createElement('input', {
                    type: 'range',
                    min: '1',
                    max: '240',
                    value: state.speed,
                    onChange: changeSpeed,
                    className: 'w-32'
                  }),
                  React.createElement(
                    'span',
                    { className: 'text-sm text-gray-600' },
                    `${state.speed} steps/s`
                  )
                ),
                
                React.createElement(
                  'button',
                  {
                    onClick: toggleViewMode,
                    className: 'px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600 transition-colors flex items-center gap-2'
                  },
                  React.createElement(Activity, { size: 16 }),
                  state.viewMode === 'phenomenal' ? 'Substrate' : 'Phenomenal'
                ),
                
                React.createElement(
                  'div',
                  { className: 'text-sm text-gray-600' },
                  `Step: ${state.timeStep} `,
                  state.paused && React.createElement(
                    'span',
                    { className: 'text-red-600 font-bold' },
                    '(PAUSED)'
                  )
                )
              ),
              
              // Simulation grid
              React.createElement(
                'div',
                { className: 'border border-gray-300 inline-block bg-gray-50 p-2 rounded' },
                React.createElement(
                  'div',
                  {
                    className: 'grid',
                    style: {
                      gridTemplateColumns: `repeat(${WORLD_SIZE}, 15px)`,
                      gap: '0'
                    }
                  },
                  state.substrate && state.substrate.map((row, y) => 
                    row.map((cell, x) => renderCell(cell, x, y, state.agent, state.viewMode))
                  )
                )
              ),
              
              // Description
              React.createElement(
                'div',
                { className: 'mt-4 text-sm text-gray-600' },
                state.viewMode === 'phenomenal' ? (
                  React.createElement(React.Fragment, null,
                    'This IS the agent\\'s world. The agent first predicts (?) what gradients might mean, then confirms through interaction:',
                    React.createElement('br', null),
                    'Berries 🍓, Bushes 🌿, Grass 🌱, Trees 🌳, and Stones ⬤. Light areas show predictions; solid colors = confirmed objects.',
                    React.createElement('br', null),
                    'When the agent dies, this world vanishes—all that remains is the mathematical substrate.'
                  )
                ) : (
                  React.createElement(React.Fragment, null,
                    'The substrate contains only mathematical gradients. Warm colors show positive gradients, cool colors show negative gradients.',
                    React.createElement('br', null),
                    'The agent must construct meaning from these undifferentiated variations through interaction.'
                  )
                )
              )
            ),
            
            // Right panel - Stats
            React.createElement(
              'div',
              { className: 'space-y-6' },
              // Consciousness
              React.createElement(
                'div',
                { className: 'bg-white rounded-lg shadow-lg p-6' },
                React.createElement(
                  'h3',
                  { className: 'text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2' },
                  React.createElement(Brain, { className: 'text-purple-500' }),
                  'Consciousness'
                ),
                React.createElement(
                  'div',
                  { className: 'mb-4' },
                  React.createElement(
                    'div',
                    { className: 'text-sm text-gray-600 mb-1' },
                    'World-Construction Coherence'
                  ),
                  React.createElement(
                    'div',
                    { className: 'w-full bg-gray-200 rounded-full h-4' },
                    React.createElement('div', {
                      className: 'bg-purple-500 h-4 rounded-full transition-all duration-500',
                      style: { width: `${state.consciousness}%` }
                    })
                  ),
                  React.createElement(
                    'div',
                    { className: 'text-right text-sm text-gray-600 mt-1' },
                    `${state.consciousness.toFixed(1)}%`
                  )
                ),
                React.createElement(
                  'p',
                  { className: 'text-xs text-gray-500' },
                  'Consciousness emerges from the agent\\'s ability to predict and construct its world. ' +
                  'Higher consciousness means more accurate predictions, diverse object types discovered, ' +
                  'and a larger, more coherent phenomenal world.'
                )
              ),
              
              // Homeostatic state
              React.createElement(
                'div',
                { className: 'bg-white rounded-lg shadow-lg p-6' },
                React.createElement(
                  'h3',
                  { className: 'text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2' },
                  React.createElement(Zap, { className: 'text-yellow-500' }),
                  'Homeostatic State'
                ),
                React.createElement(
                  'div',
                  { className: 'space-y-3' },
                  React.createElement(
                    'div',
                    null,
                    React.createElement(
                      'div',
                      { className: 'text-sm text-gray-600 mb-1' },
                      'Energy'
                    ),
                    React.createElement(
                      'div',
                      { className: 'w-full bg-gray-200 rounded-full h-3' },
                      React.createElement('div', {
                        className: 'h-3 rounded-full transition-all duration-300',
                        style: { 
                          width: `${Math.max(0, Math.min(100, (state.agent.energy / MAX_ENERGY) * 100))}%`,
                          backgroundColor: state.agent.energy > 300 ? '#22c55e' : 
                                         state.agent.energy > 100 ? '#eab308' : '#ef4444'
                        }
                      })
                    ),
                    React.createElement(
                      'div',
                      { className: 'text-right text-sm text-gray-600 mt-1' },
                      `${state.agent.energy}/${MAX_ENERGY}`
                    )
                  )
                )
              )
            )
          )
        )
      );
    };

    // Initialize lucide icons
    lucide.icons = {
      play: { toSvg: () => '▶' },
      pause: { toSvg: () => '⏸' },
      rotateCcw: { toSvg: () => '↻' },
      zap: { toSvg: () => '⚡' },
      brain: { toSvg: () => '🧠' },
      activity: { toSvg: () => '⟳' }
    };

    // Render the app
    const container = document.getElementById('root');
    const root = createRoot(container);
    root.render(React.createElement(MDOConsciousnessSimulation));
  </script>
</body>
</html>
